/**
* \file OS_RTC.c
* \brief System Time managment functions
*
* Functions to reset and update the system time and date
*
**/
/*********************************************************************************************************
*                                               BRTOS
*                                Brazilian Real-Time Operating System
*                            Acronymous of Basic Real-Time Operating System
*
*                              
*                                  Open Source RTOS under MIT License
*
*
*
*                                      OS Time managment functions
*
*
*   Author:   Gustavo Weber Denardin
*   Revision: 1.1
*   Date:     11/03/2010
*
*   Authors:  Carlos Henrique Barriquelo e Gustavo Weber Denardin
*   Revision: 1.2
*   Date:     01/10/2010
*
*   Authors:  Carlos Henrique Barriquelo e Gustavo Weber Denardin
*   Revision: 1.3
*   Date:     11/10/2010
*
*   Authors:  Carlos Henrique Barriquelo e Gustavo Weber Denardin
*   Revision: 1.4
*   Date:     19/10/2010
*
*   Authors:  Carlos Henrique Barriquelo e Gustavo Weber Denardin
*   Revision: 1.41
*   Date:     20/10/2010
*
*********************************************************************************************************/

#include "BRTOS.h"

// estrutura - Hora
  OSTime Hora;
  OSDate Data;





////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
/////      OS Update Time Function                     /////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////

void OSUpdateTime(OSTime *Ptr_Hora)
{
  OS_SR_SAVE_VAR
  
  #if (NESTING_INT == 0)
  if (!iNesting)
  #endif
     OSEnterCritical();
     
  Ptr_Hora -> RTC_Second++;

 	if (Ptr_Hora -> RTC_Second == 60){

 		Ptr_Hora -> RTC_Second = 0;
 		Ptr_Hora -> RTC_Minute++;

 	if (Ptr_Hora -> RTC_Minute == 60){

 		Ptr_Hora -> RTC_Minute = 0;
 		Ptr_Hora -> RTC_Hour++;

 	if (Ptr_Hora -> RTC_Hour == 24){

 		Ptr_Hora -> RTC_Hour = 0;
  		
 	}}}
  	
  #if (NESTING_INT == 0)
  if (!iNesting)
  #endif
     OSExitCritical();
	
}

////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////





////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
/////      OS Update Time Function                     /////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////

void OSUpdateUptime(OSTime *Ptr_Hora,OSDate *Ptr_Dia)
{
  OS_SR_SAVE_VAR

  #if (NESTING_INT == 0)
  if (!iNesting)
  #endif
     OSEnterCritical();
     
  Ptr_Hora -> RTC_Second++;

  if (Ptr_Hora -> RTC_Second == 60){

  	Ptr_Hora -> RTC_Second = 0;
  	Ptr_Hora -> RTC_Minute++;

  if (Ptr_Hora -> RTC_Minute == 60){

  	Ptr_Hora -> RTC_Minute = 0;
  	Ptr_Hora -> RTC_Hour++;

  if (Ptr_Hora -> RTC_Hour == 24){

  	Ptr_Hora -> RTC_Hour = 0;
  	Ptr_Dia -> RTC_Day++;
  		
  }}}
  
  #if (NESTING_INT == 0)
  if (!iNesting)
  #endif
     OSExitCritical();
}

////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////





////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
/////      OS Update Date Function                     /////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////

void OSUpdateDate(OSDate *Ptr_Dia)
{   
  OS_SR_SAVE_VAR
  
  #if (NESTING_INT == 0)
  if (!iNesting)
  #endif
     OSEnterCritical();
     
	Ptr_Dia -> RTC_Day++;	
		
	if (Ptr_Dia -> RTC_Day == 30){ 
	// deve-se adaptar para os dias exatos de cada mês

		Ptr_Dia -> RTC_Day = 0;
		Ptr_Dia -> RTC_Month++;

	if (Ptr_Dia -> RTC_Month == 12){

		Ptr_Dia -> RTC_Month = 0;
		Ptr_Dia -> RTC_Year++;

	if (Ptr_Dia -> RTC_Year == 9999){    // ano máximo 9999	

		Ptr_Dia -> RTC_Year = 0;
	}}}
	
  #if (NESTING_INT == 0)
  if (!iNesting)
  #endif
     OSExitCritical();
	
}

////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////





////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
/////      OS Reset Time Function                      /////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////

void OSResetTime(OSTime *Ptr_Hora)
{
  OS_SR_SAVE_VAR
        
  #if (NESTING_INT == 0)
  if (!iNesting)
  #endif
     OSEnterCritical();
     
   (Ptr_Hora->RTC_Second) = 0;
   (Ptr_Hora->RTC_Minute) = 0;
   (Ptr_Hora->RTC_Hour) = 0;
   
  #if (NESTING_INT == 0)
  if (!iNesting)
  #endif
     OSExitCritical();
      
}

////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////    





////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
/////      OS Reset Date Function                      /////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
 
void OSResetDate(OSDate *Ptr_Dia)
{
  OS_SR_SAVE_VAR
     
  #if (NESTING_INT == 0)
  if (!iNesting)
  #endif
     OSEnterCritical();
     
   Ptr_Dia->RTC_Day = 0;
   Ptr_Dia->RTC_Month = 0;
   Ptr_Dia->RTC_Year = 0;
   
  #if (NESTING_INT == 0)
  if (!iNesting)
  #endif
     OSExitCritical();
      
}

////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////




 
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
/////      Return Time Function                        /////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
 
OSTime OSUptime(void)
{
  return Hora;
}

////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////





////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
/////      Return Date Function                        /////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////

OSDate OSUpDate(void)
{
  return Data;
}

////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
